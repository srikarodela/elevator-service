<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Elevator Services</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav>
            <div class="container">
                <div class="logo">
                    <h1>Elevator Services - Admin</h1>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="service.html">Request Service</a></li>
                    <li><a href="modules.html">Modules</a></li>
                    <li><a href="#" onclick="logout()" style="color: #e74c3c;">Logout</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="admin-dashboard">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Admin Dashboard</h2>
                    <div class="dashboard-nav">
                        <button class="btn btn-primary" onclick="showSection('requests')">Service Requests</button>
                        <button class="btn btn-secondary" onclick="showSection('modules')">Manage Modules</button>
                    </div>
                </div>

                <div class="dashboard-content">
                    <!-- Service Requests Section -->
                    <div id="requestsSection" class="dashboard-section">
                        <h3>Service Requests</h3>
                        <div id="requestsMessage"></div>
                        <div id="requestsTableContainer">
                            <!-- Requests table will be loaded here -->
                        </div>
                    </div>

                    <!-- Modules Management Section -->
                    <div id="modulesSection" class="dashboard-section hidden">
                        <h3>Manage Elevator Modules</h3>
                        <div id="modulesMessage"></div>
                        
                        <div class="module-form">
                            <h4 id="moduleFormTitle">Add New Module</h4>
                            <form id="moduleForm">
                                <input type="hidden" id="moduleId">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="moduleTitle">Title *</label>
                                        <input type="text" id="moduleTitle" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="moduleCapacity">Capacity *</label>
                                        <input type="text" id="moduleCapacity" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="moduleSpeed">Speed *</label>
                                        <input type="text" id="moduleSpeed" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="moduleDescription">Description *</label>
                                        <input type="text" id="moduleDescription" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="moduleFeatures">Features (comma-separated) *</label>
                                    <input type="text" id="moduleFeatures" required placeholder="Feature 1, Feature 2, Feature 3">
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="resetModuleForm()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save Module</button>
                                </div>
                            </form>
                        </div>
                        
                        <div id="modulesTableContainer">
                            <!-- Modules table will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Contact Information</h3>
                    <p><strong>Phone:</strong> +1-234-567-8900</p>
                    <p><strong>Email:</strong> info@elevatorservices.com</p>
                    <p><strong>Address:</strong> 123 Main Street, City, State 12345</p>
                </div>
                <div class="footer-section">
                    <h3>Business Hours</h3>
                    <p>Monday - Friday: 8:00 AM - 6:00 PM</p>
                    <p>Saturday: 9:00 AM - 4:00 PM</p>
                    <p>Sunday: Emergency Services Only</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="service.html">Request Service</a></li>
                        <li><a href="modules.html">Modules</a></li>
                        <li><a href="admin.html">Admin Login</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Elevator Services. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        // Check authentication
        document.addEventListener('DOMContentLoaded', function() {
            if (!AdminAuth.requireAuth()) {
                return;
            }
            loadServiceRequests();
            loadModules();
            showSection('requests');
        });

        function showSection(section) {
            document.querySelectorAll('.dashboard-section').forEach(sec => {
                sec.classList.add('hidden');
            });
            
            if (section === 'requests') {
                document.getElementById('requestsSection').classList.remove('hidden');
                loadServiceRequests();
            } else if (section === 'modules') {
                document.getElementById('modulesSection').classList.remove('hidden');
                loadModules();
            }
        }

        function logout() {
            AdminAuth.logout();
            window.location.href = 'admin.html';
        }

        // Service Requests Management
        function loadServiceRequests() {
            const requests = ServiceRequestManager.getAllRequests();
            const container = document.getElementById('requestsTableContainer');
            
            if (requests.length === 0) {
                container.innerHTML = '<div class="no-modules"><h3>No service requests</h3><p>No service requests have been submitted yet.</p></div>';
                return;
            }
            
            const tableHTML = `
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Location</th>
                            <th>Elevator Type</th>
                            <th>Problem</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${requests.map(request => `
                            <tr>
                                <td>#${request.id}</td>
                                <td>${request.name}</td>
                                <td>${request.phone}</td>
                                <td>${request.email}</td>
                                <td>${request.location}</td>
                                <td>${request.elevatorType}</td>
                                <td>${request.problem.substring(0, 50)}${request.problem.length > 50 ? '...' : ''}</td>
                                <td>
                                    <span class="status-badge status-${request.status}">
                                        ${request.status.charAt(0).toUpperCase() + request.status.slice(1).replace('-', ' ')}
                                    </span>
                                </td>
                                <td>${formatDate(request.createdAt)}</td>
                                <td>
                                    <div class="action-buttons">
                                        ${request.status === 'pending' ? `<button class="btn btn-small btn-success" onclick="updateRequestStatus(${request.id}, 'in-progress')">In Progress</button>` : ''}
                                        ${request.status === 'in-progress' ? `<button class="btn btn-small btn-success" onclick="updateRequestStatus(${request.id}, 'completed')">Complete</button>` : ''}
                                        <button class="btn btn-small btn-delete" onclick="deleteRequest(${request.id})">Delete</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }

        function updateRequestStatus(requestId, newStatus) {
            if (ServiceRequestManager.updateRequestStatus(requestId, newStatus)) {
                showMessage('Request status updated successfully!', 'success');
                loadServiceRequests();
            } else {
                showMessage('Error updating request status', 'error');
            }
        }

        function deleteRequest(requestId) {
            if (confirm('Are you sure you want to delete this request?')) {
                if (ServiceRequestManager.deleteRequest(requestId)) {
                    showMessage('Request deleted successfully!', 'success');
                    loadServiceRequests();
                } else {
                    showMessage('Error deleting request', 'error');
                }
            }
        }

        // Modules Management
        function loadModules() {
            const modules = ModuleManager.getAllModules();
            const container = document.getElementById('modulesTableContainer');
            
            if (modules.length === 0) {
                container.innerHTML = '<div class="no-modules"><h3>No modules available</h3><p>No modules have been added yet.</p></div>';
                return;
            }
            
            const tableHTML = `
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Capacity</th>
                            <th>Speed</th>
                            <th>Features</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${modules.map(module => `
                            <tr>
                                <td>#${module.id}</td>
                                <td>${module.title}</td>
                                <td>${module.description}</td>
                                <td>${module.capacity}</td>
                                <td>${module.speed}</td>
                                <td>${module.features.join(', ')}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-small btn-edit" onclick="editModule(${module.id})">Edit</button>
                                        <button class="btn btn-small btn-delete" onclick="deleteModule(${module.id})">Delete</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }

        function editModule(moduleId) {
            const modules = ModuleManager.getAllModules();
            const module = modules.find(m => m.id === moduleId);
            
            if (module) {
                document.getElementById('moduleFormTitle').textContent = 'Edit Module';
                document.getElementById('moduleId').value = module.id;
                document.getElementById('moduleTitle').value = module.title;
                document.getElementById('moduleDescription').value = module.description;
                document.getElementById('moduleCapacity').value = module.capacity;
                document.getElementById('moduleSpeed').value = module.speed;
                document.getElementById('moduleFeatures').value = module.features.join(', ');
                
                // Scroll to form
                document.querySelector('.module-form').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function deleteModule(moduleId) {
            if (confirm('Are you sure you want to delete this module?')) {
                if (ModuleManager.deleteModule(moduleId)) {
                    showMessage('Module deleted successfully!', 'success');
                    loadModules();
                } else {
                    showMessage('Error deleting module', 'error');
                }
            }
        }

        function resetModuleForm() {
            document.getElementById('moduleFormTitle').textContent = 'Add New Module';
            document.getElementById('moduleForm').reset();
            document.getElementById('moduleId').value = '';
        }

        // Module form submission
        document.getElementById('moduleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const moduleId = document.getElementById('moduleId').value;
            const moduleData = {
                title: document.getElementById('moduleTitle').value,
                description: document.getElementById('moduleDescription').value,
                capacity: document.getElementById('moduleCapacity').value,
                speed: document.getElementById('moduleSpeed').value,
                features: document.getElementById('moduleFeatures').value.split(',').map(f => f.trim()).filter(f => f)
            };
            
            let success = false;
            if (moduleId) {
                success = ModuleManager.updateModule(parseInt(moduleId), moduleData);
                if (success) {
                    showMessage('Module updated successfully!', 'success');
                }
            } else {
                ModuleManager.addModule(moduleData);
                showMessage('Module added successfully!', 'success');
                success = true;
            }
            
            if (success) {
                resetModuleForm();
                loadModules();
            } else {
                showMessage('Error saving module', 'error');
            }
        });
    </script>
</body>
</html>
